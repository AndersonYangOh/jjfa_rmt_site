window.top!=self&&(window.top.location=self.location);var $url="/pages/main",$urlCreate="/pages/main/actions/create",$urlDownload="/pages/main/actions/download",$packageIdSsCms="SS.CMS",$siteId=parseInt(utils.getQueryString("siteId")||"0"),data={pageLoad:!1,pageAlert:null,defaultPageUrl:null,isNightly:null,pluginVersion:null,productVersion:null,targetFramework:null,environmentVersion:null,isSuperAdmin:null,packageList:null,packageIds:null,topMenus:null,siteMenus:null,activeParentMenu:null,activeChildMenu:null,pluginMenus:null,local:null,newVersion:null,updatePackages:0,pendingCount:0,lastExecuteTime:new Date,timeoutId:null,winHeight:0,winWidth:0,isDesktop:!0,isMobileMenu:!1},methods={getConfig:function(){var e=this;$api.get($url+"?siteId="+$siteId).then(function(t){var n=t.data;n.value?(e.defaultPageUrl=n.defaultPageUrl,e.isNightly=n.isNightly,e.pluginVersion=n.pluginVersion,e.productVersion=n.productVersion,e.targetFramework=n.targetFramework,e.environmentVersion=n.environmentVersion,e.isSuperAdmin=n.isSuperAdmin,e.packageList=n.packageList,e.packageIds=n.packageIds,e.topMenus=n.topMenus,e.siteMenus=n.siteMenus,e.pluginMenus=n.pluginMenus,e.local=n.local,e.activeParentMenu=e.siteMenus[0]):location.href=n.redirectUrl}).catch(function(t){401===t.response.status?location.href="pageLogin.cshtml":500===t.response.status&&(e.pageAlert=utils.getPageAlert(t))}).then(function(){e.pageLoad=!0,setTimeout(e.ready,100)})},ready:function(){var e=this;window.onresize=e.winResize,window.onresize(),e.create(),e.isSuperAdmin&&e.getUpdates(),setInterval(function(){((new Date).getTime()-e.lastExecuteTime.getTime())/1e3/60>2&&e.create()},6e4)},getUpdates:function(){var e=this;$apiCloud.get("updates",{params:{isNightly:e.isNightly,pluginVersion:e.pluginVersion,targetFramework:e.targetFramework,environmentVersion:e.environmentVersion,packageIds:e.packageIds.join(",")}}).then(function(t){for(var n=t.data,i=0;i<n.value.length;i++){var a=n.value[i];if(a&&a.version)if(a.pluginId==$packageIdSsCms)e.downloadSsCms(a);else{var s=$.grep(e.packageList,function(e){return e.id==a.pluginId});if(1==s.length){var r=s[0];r.version?-1==compareversion(r.version,a.version)&&e.updatePackages++:e.updatePackages++}}}}).then(function(){e.pageLoad=!0})},downloadSsCms:function(e){var t=this;if(-1==compareversion(t.productVersion,e.version)){var n=e.version.split(".")[0],i=e.version.split(".")[1];$api.post($urlDownload,{packageId:$packageIdSsCms,version:e.version}).then(function(a){a.data.value&&(t.newVersion={updatesUrl:"https://www.siteserver.cn/updates/v"+n+"_"+i+"/index.html",version:e.version,published:e.published,releaseNotes:e.releaseNotes})})}},create:function(){var e=this;clearTimeout(e.timeoutId);var t=localStorage.getItem("sessionId");$api.post($urlCreate,{sessionId:t}).then(function(t){var n=t.data;e.pendingCount=n.value,0===e.pendingCount?e.timeoutId=setTimeout(e.create,1e4):e.timeoutId=setTimeout(e.create,100)}).catch(function(t){401===t.response.status&&(location.href="pageLogin.cshtml"),e.timeoutId=setTimeout(e.create,1e3)}).then(function(){e.lastExecuteTime=new Date})},winResize:function(){this.winHeight=$(window).height(),this.winWidth=$(window).width(),this.isDesktop=this.winWidth>992},getHref:function(e){return e.href&&"_layer"!=e.target?e.href:"javascript:;"},getTarget:function(e){return e.target?e.target:"right"},btnTopMenuClick:function(e){"_layer"==e.target&&utils.openLayer({title:e.text,url:e.href,full:!0})},btnLeftMenuClick:function(e){e.hasChildren?this.activeParentMenu=this.activeParentMenu===e?null:e:(this.activeChildMenu=e,this.isMobileMenu=!1,"_layer"==e.target&&utils.openLayer({title:e.text,url:e.href,full:!0}))},btnMobileMenuClick:function(){this.isMobileMenu=!this.isMobileMenu}};function redirect(e){$("#right").src=e}function openPageCreateStatus(){return utils.openLayer({title:"生成进度查看",url:"cms/createStatus.cshtml?siteId="+$siteId,full:!0}),!1}function reloadPage(){document.getElementById("frmMain").contentWindow.location.reload(!0)}new Vue({el:"#wrapper",data:data,methods:methods,created:function(){this.getConfig()},computed:{leftMenuWidth:function(){return this.isDesktop?"200px":this.isMobileMenu?"100%":"200px"}}});